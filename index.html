<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalayan Glory POS</title>
    <style>
        :root { --primary: #2ecc71; --dark: #000; }
        body { font-family: 'Inter', sans-serif; margin: 0; background: var(--dark); color: #fff; height: 100vh; overflow: hidden; }
        #entrance-screen { position: fixed; inset: 0; background: #000; z-index: 2000; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 40px; text-align: center; }
        .logo-main { width: 150px; height: 150px; border-radius: 50%; border: 3px solid #333; margin-bottom: 20px; }
        .btn-start { background: var(--primary); color: #000; width: 100%; padding: 22px; border-radius: 50px; font-size: 18px; font-weight: 800; border: none; }
        #main-app { display: none; height: 100vh; flex-direction: column; background: #fff; color: #000; }
        #camera-section { height: 40vh; background: #000; position: relative; }
        #webcam { width: 100%; height: 100%; object-fit: cover; }
        #status-bar { position: absolute; bottom: 10px; left: 10px; background: rgba(0,0,0,0.8); color: #0f0; padding: 8px 15px; border-radius: 20px; font-family: monospace; font-size: 11px; z-index: 100; }
        
        /* THE X-RAY DEBUG BOX */
        #debug-box { position: absolute; top: 10px; left: 10px; right: 10px; background: rgba(255,0,0,0.8); color: #fff; padding: 10px; border-radius: 10px; font-family: monospace; font-size: 10px; z-index: 100; word-wrap: break-word; max-height: 80px; overflow: hidden; }
    </style>
</head>
<body>

<div id="entrance-screen">
    <img src="https://i.ibb.co/6PZ8X7z/IMG-1320.png" class="logo-main">
    <h1>HIMALAYAN GLORY</h1>
    <button class="btn-start" onclick="launchPOS()">START DIAGNOSTIC</button>
</div>

<div id="main-app">
    <div id="camera-section">
        <div id="debug-box">Waiting for Roboflow server...</div>
        <div id="status-bar">AI Status: Offline</div>
        <video id="webcam" autoplay playsinline muted></video>
        <canvas id="snapshot" style="display:none;"></canvas>
    </div>
    <div id="billing-section" style="padding: 20px; text-align: center;">
        <h3 style="color:#666; margin-top: 50px;">Look at the red box on the camera</h3>
        <p style="color:#999;">Tell me what text appears inside it.</p>
    </div>
</div>

<script>
    const CONFIG = {
        apiKey: "8n3ZmJUiFbggayPObv7S", 
        workspace: "hgmm-pos",          
        workflow: "find-cadbury-dairy-milk-10s" 
    };

    let isScanning = true;
    const status = document.getElementById('status-bar');
    const debugBox = document.getElementById('debug-box');

    async function launchPOS() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
            document.getElementById('entrance-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'flex';
            document.getElementById('webcam').srcObject = stream;
            
            status.innerText = "AI Online: Searching...";
            runInferenceLoop();
        } catch (err) { alert("Camera Error"); }
    }

    async function runInferenceLoop() {
        if (!isScanning) return setTimeout(runInferenceLoop, 1000);

        const video = document.getElementById('webcam');
        const canvas = document.getElementById('snapshot');
        canvas.width = video.videoWidth || 640;
        canvas.height = video.videoHeight || 480;
        canvas.getContext('2d').drawImage(video, 0, 0);
        
        const base64Image = canvas.toDataURL('image/jpeg', 0.4).split(',')[1];

        try {
            const response = await fetch(`https://serverless.roboflow.com/${CONFIG.workspace}/workflows/${CONFIG.workflow}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    api_key: CONFIG.apiKey,
                    inputs: { "image": { "type": "base64", "value": base64Image } }
                })
            });

            const result = await response.json();
            
            // X-RAY VISION: Print the exact data to the screen
            debugBox.innerText = JSON.stringify(result);

            // Attempting to guess the structure
            if (result.outputs) {
                status.innerText = "Data received, analyzing structure...";
            } else {
                status.innerText = "AI Online: Searching...";
            }

        } catch (e) { 
            debugBox.innerText = "NETWORK ERROR: " + e.message; 
        }

        setTimeout(runInferenceLoop, 1000);
    }
</script>
</body>
</html>
