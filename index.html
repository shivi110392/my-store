<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalayan Glory POS</title>
    <script src="https://cdn.jsdelivr.net/npm/@roboflow/inference-sdk@0.2.0/dist/inference-sdk.min.js"></script>
    <style>
        :root { --primary: #2ecc71; --dark: #000; }
        body { font-family: 'Inter', sans-serif; margin: 0; background: var(--dark); color: #fff; height: 100vh; overflow: hidden; }
        #entrance-screen { position: fixed; inset: 0; background: #000; z-index: 2000; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 40px; }
        .logo-main { width: 180px; height: 180px; border-radius: 50%; border: 3px solid #333; margin-bottom: 30px; }
        .btn-start { background: var(--primary); color: #000; width: 100%; max-width: 300px; padding: 20px; border-radius: 50px; font-size: 18px; font-weight: 800; border: none; cursor: pointer; }
        #main-app { display: none; height: 100vh; flex-direction: column; background: #fff; color: #000; }
        #camera-section { height: 35vh; background: #000; position: relative; overflow: hidden; }
        #webcam { width: 100%; height: 100%; object-fit: cover; }
        #status-bar { position: absolute; bottom: 10px; left: 10px; background: rgba(0,0,0,0.8); color: #0f0; padding: 6px 12px; border-radius: 20px; font-family: monospace; font-size: 11px; z-index: 100; border: 1px solid #333; }
        #billing-section { flex: 1; padding: 20px; display: flex; flex-direction: column; }
        .summary-card { background: #f9f9f9; border-radius: 20px; padding: 20px; border: 1px solid #eee; margin-top: auto; }
        .total-row { display: flex; justify-content: space-between; font-size: 28px; font-weight: 900; }
    </style>
</head>
<body>

<div id="entrance-screen">
    <img src="https://i.ibb.co/6PZ8X7z/IMG-1320.png" class="logo-main">
    <h2 style="margin-bottom: 30px; font-weight: 900;">HIMALAYAN GLORY</h2>
    <button class="btn-start" onclick="initSystem()">ENABLE CAMERA & START</button>
</div>

<div id="main-app">
    <div id="camera-section">
        <div id="status-bar">Starting AI...</div>
        <video id="webcam" autoplay playsinline muted></video>
    </div>
    <div id="billing-section">
        <div id="cart-items" style="flex:1; overflow-y:auto; padding-top:20px; text-align:center; color:#999;">Scan items to begin...</div>
        <div class="summary-card">
            <div class="total-row"><span>TOTAL</span><span>â‚¹<span id="sum-total">0</span></span></div>
            <button class="btn-start" style="width:100%; margin-top:20px; border-radius:15px;" onclick="location.reload()">NEW BILL</button>
        </div>
    </div>
</div>

<script>
    const CONFIG = {
        publishableKey: "rf_XuU7NpIlxmfQbw24Mb3kU0GxfjB2", // Your Publishable Key
        workspace: "hgmm-pos",                           // Your Workspace
        workflow: "find-cadbury-dairy-milk-10s",         // Your Workflow
        sheet: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQyhBP3yyTYrAJR_-luY7Yr5P7PVKLHRleiH9LWMTASiL7sh0HpZDf2ji5s__ddYcSaS-9aFg5Epz9x/pub?output=csv"
    };

    async function initSystem() {
        const status = document.getElementById('status-bar');
        try {
            // STEP 1: FORCE BROWSER PERMISSION POPUP
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
            
            document.getElementById('entrance-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'flex';
            document.getElementById('webcam').srcObject = stream;

            // STEP 2: INITIALIZE AI STREAM
            const sdk = window.inference;
            const connector = sdk.connectors.withPublishableKey(CONFIG.publishableKey);
            
            await sdk.webrtc.useStream({
                source: stream,
                connector: connector,
                wrtcParams: {
                    workspaceName: CONFIG.workspace,
                    workflowId: CONFIG.workflow,
                    imageInputName: "image",
                    dataOutputNames: ["predictions"]
                },
                onData: (data) => {
                    if(data.predictions?.length > 0) {
                        status.innerText = `Online: Seeing ${data.predictions[0].class}`;
                    } else {
                        status.innerText = "AI Online: Scanning Area...";
                    }
                }
            });
        } catch (err) {
            status.style.color = "red";
            status.innerText = "Error: Please check camera settings.";
            console.error(err);
        }
    }
</script>
</body>
</html>
